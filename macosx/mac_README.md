# Building a Mac OS X Package


To build the distribution package for Gregorio for Mac, you first need to install [Packages](http://s.sudre.free.fr/Software/Packages/about.html) and [Pandoc](johnmacfarlane.net/pandoc/index.html).  Once those are installed, simply run:

`create_pacakge.sh`

This script contains all the necessary commands to create the distribution package.  It will first build and "install" the package into the `macosx` directory (this way we know where everything is).  It will then use Pandoc to convert the necessary documentation files from markdown to html (the format required by Packages).  Once that's done, it will use the command line interface for Packages to build the installer package.

It will also build an Uninstall package which has an empty payload.  This package runs a post-flight script which knows where the installed components of Gregorio are and removes them.


## Limitations

It is problematic (to say the least) for a package installer to place files in a user's home directory on a Mac.  As a result, this installer will always target a systme-wide installation for both the command-line tool and TeX Live.

This installer is only targeted at Intel based Macs.

The `.pkgproj` files are XML generated by Packages that contain the information specifying the different properties of the installers.  Under most circumstances you won't need to edit them, as most changes won't affect the name and location of the files which need to be installed or used by the installer, just their contents.  Furthermore, payload files for `Gregorio.pkgproj` are included via the top level folders in the `build` directory (i.e. `usr`, `tmp`, and `Gregorio`).  Thus changes are only necessary to `Gregorio.pkgproj` if a change necessitates removing one of those folders or adding another.  Since the files are XML, you might be able to make the appropriate adjustments with an ordinary text editor, but I don't advise it.

In order to identify the line which contains the version number in `Gregorio.pkgproj` the comment `<!--GREGORIO_VERSION-->` (something `VersionManager.py` already recognizes as a version number indicator) has been added to that line.  This was done because the XML structure does not provide a unique identifier either on that line or close by.  **This comment will be lost if you open, edit, and resave `Gregorio.pkgproj`.**  If you find it necessary to edit `Gregorio.pkgproj` you will need to open the file with a text editor after you have made your changes in Packages, find the line with the Gregorio version number, and add the above named comment to the end of that line.

Eventually we'd like to move away from using Packages and switch to using the XCode command line tools directly, but that is a project for another day.
